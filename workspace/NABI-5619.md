# Task 【Giver】新增FB連結回傳欄位_2025/5月
[Jira](https://104corp.atlassian.net/browse/NABI-5619)

## 需求&規則

Nabi 開發 API：

課程下架就不回傳
排序依照七天內點擊數
Cache 12 小時

1.用 resource id 查詢課程，可一次查多筆
2.用 jobcat id + provider id 查課程，可一次最多查 3 個 jobcat
3.用 ability id + provider id 查課程，可一次最多查 3 個 ability

課程元件預計呈現資料欄位： > CourseApimOutModel
課程圖片 nabi_3rd_course.images
課程類型 nabi_3rd_course.course_type
課程名稱 nabi_3rd_course.title
是否有優惠 > 從cache拿
是瀏覽數 > nabi_resource_social_count
連結網址 > resource_id加工
 
## 流程
使用方直接呼叫API取得資訊呈現
 
## 開發範疇
### 後端
#### 開發三隻API
ref: api_course/apim/views.py
課程類型，要回傳文字
是否有優惠 需要看是導流課或是金流課，可以參考之前apim 程式碼
搜尋以view_count優先，回傳內容也以view_count高到低排序



1. apim transfer拉出來共用
    - course_url 規則整理 > film / cousre
2. resource id 查詢課程
post /list/resourced_id
```
input
{
    resource_ids: [1, 2, ...]
}
output:OffsetPageOutModel[CourseApimOutModel]
```
1. jobcat + provider id 查詢課程
   - join nabi_3rd_course_jobcat
post /list/jobcat
```
input
{
    jobcats: [1, 2, ...],
    provider_id: 1, // 非必填
    size:10, // 上限十筆
}
output:[CourseApimOutModel]
```
1. ability id + provider id 查詢課程
   - join nabi_resource_tag
```
input
{
    abilities: [1, 2, ...],
    provider_id: 1, // 非必填
    size:10, // 上限十筆
}
output:[CourseApimOutModel]
```
#### 額外調整apim上的cache
get /api/certify/apim/{certify_no}
4001001019
post /api/classroom/apim/hot_list
get /api/course/apim/banners
get /api/course/apim/hots
post /api/course/apim/hots
get /api/course/apim/career/recommend/{jobcat}
post /api/course/apim/search
post /api/course/apim/recommend

### 上版注意

### 驗收注意
壓力測試

### 延伸議題

# prompt
## api 1
我要開發一個API
用post輸入複數resource_id，去資料庫搜尋出對應的資料

1.請程式內容檔案位置參考api_course/apim/views.py裡面的 post "/search"，下面稱參考API
2.不需要開新檔案，都跟參考API用相同邏輯放置程式碼
3.coding style、輸出格式與取出的欄位也比照參考API
4.重點是因為搜尋範圍會變小，請幫我優化查詢語法，做最小量的join達到效率最大化
5.幫我把資料處理共用的transfer方法拉出來外面
6.cache需要12小時，cache使用的方法也跟參考API一樣的形式，建立在一樣的地方
7.搜尋以view_count優先，回傳內容也以view_count高到低排序

post /list/resourced_id
```
input
{
    resource_ids: ['1', '2', ...]
}
output:[CourseApimOutModel]
```

## api 2
我要開發一個API
用post輸入複數resource_id，去資料庫搜尋出對應的資料

1.請程式內容檔案位置參考api_course/apim/views.py裡面的 post "/list/resourced_id"，下面稱參考API
2.不需要開新檔案，都跟參考API用相同邏輯放置程式碼
3.coding style、輸出格式與取出的欄位也比照參考API
4.重點是因為搜尋範圍會變小，請幫我優化查詢語法，做最小量的join達到效率最大化
5.幫我把資料處理共用的transfer方法拉出來外面
6.cache需要12小時，cache使用的方法也跟參考API用相同的方法
7.搜尋以view_count_7優先，回傳內容也以view_count_7高到低排序
8.jobcat是我公司的特殊編碼，編碼有其規則，他的條件處理參考api_course/apim/actions.py裡面的"get_center_career_recommend"
post /list/jobcat
```
input
{
    jobcats: [1, 2, ...], //超過三筆只取前三筆
    provider_id: 1, // 非必填
    size:10, // 上限十筆
}
output:[CourseApimOutModel]
```

## api 3
我要開發一個API
用post輸入複數abilities，去資料庫搜尋出對應的資料
abilities要join nabi_resource_tag 透過ability_id進行篩選

1.請程式內容檔案位置參考api_course/apim/views.py裡面的 post "/list/jobcat"，下面稱參考API
2.不需要開新檔案，都跟參考API用相同邏輯放置程式碼
3.coding style、輸出格式與取出的欄位也比照參考API
4.重點是因為搜尋範圍會變小，請幫我優化查詢語法，做最小量的join達到效率最大化
5.幫我把資料處理共用的transfer方法拉出來外面
6.cache需要12小時，cache使用的方法也跟參考API用相同的方法
7.搜尋以view_count_7優先，回傳內容也以view_count_7高到低排序
8.jobcat是我公司的特殊編碼，編碼有其規則，他的條件處理參考api_course/apim/actions.py裡面的"get_center_career_recommend"
post /list/ability
```
input
{
    abilities: [1, 2, ...], //超過三筆只取前三筆
    provider_id: 1, // 非必填
    size:10, // 上限十筆
}
output:[CourseApimOutModel]
```

## test lab
### api1
可用resource_id
``` json
[
"000a793d-12fe-42dc-b082-33faf16228e7",
"00541c20-647d-4075-8763-e39988845df2",
"0060ac29-f26f-4087-8d8f-9a8d42ad51d8",
"00758a2e-097c-4ecc-ba88-1b331adf92de",
"007722ff-3acd-4b1a-9dd7-6670ee3f1608",
"007cd840-e5f6-4169-a5b4-383fec842704",
"008ecea4-b624-4952-b4a1-083c3d49718e",
"00ac69d5-1715-4aa1-883d-674aa22e0d4f",
"00f1d85a-2c5d-484b-ab86-2f7f27d81c5e",
"00ffb4f8-92ca-4fe0-bab3-92e8a0930664",
"010ddc0e-1cd6-4671-994a-d857c9583c08",
"0110c04a-d8e3-4426-9d8e-c5edfb6681bf",
"01252ba0-0550-4898-9b35-ba5328f7c3fe",
"0133853e-4486-4982-98c6-fb9c7c950967",
"0139e9ef-dd2e-4df5-b9eb-2bcb6afab254",
"014ab571-438b-47e6-b3ce-aa41d09059a8",
"016c9062-3094-4883-9f46-28e4b3200c18",
"016f10b3-9cbd-4bef-b144-79ba1a1fd132",
"01a32ccd-60e7-46e0-8341-86df99caa861",
"01b72535-2c41-4053-937f-728e6cf8fd49"
]
```
### api2
可用jobcat
``` json
[
    2003001010,
    2003001000,
    2003000000,
    2012001000,
    2013001012,
    2015001000,
    2016000000
]
```

### api3
可用abilities
``` json
[
    10003456,
    10003382,
    10003453,
    170,
    836
    170
]
```

# Log
========================================================