壓力測試腳本需求 Prompt

一 總體需求敘述
使用 k6 工具進行壓力測試。模擬使用者對某產品功能（如活動報名流程）進行完整操作，並依據 API 回應進行資料驗證與紀錄，同時輸出測試報告。

二 非產品面需求

併發與執行策略
使用固定併發數 vus，例如 10
每個 VU 僅執行指定次數 iterationsPerVU 後退出
使用 per-vu-iterations executor
每筆測試資料只能被處理一次

測試資料來源
來源為 CSV 檔案
第一行為欄位名稱，以下每行為一筆使用者資料，例如 email nickname pid
使用 SharedArray 讀取 CSV，所有 VU 共用記憶體，但僅進行唯讀存取

API 呼叫流程
第一步呼叫報名 API add
第二步呼叫查詢 API query
呼叫順序為 add 接著 query
每一步需根據 API response 結果判斷是否進入下一步
若 add 失敗則不呼叫 query

錯誤處理
每個 API 呼叫不做 retry 僅執行一次
若失敗則記錄錯誤訊息
若 API 有 msg 欄位則記錄該欄位內容
若無 msg 則記錄 HTTP status code
錯誤內容需保證不影響 CSV 欄位結構，例如用引號包覆含逗號的錯誤訊息

時間與格式處理
每筆測試資料需記錄測試起始時間 使用本地時間
格式為 YYYYMMDD HH:MM:SS 不含逗號 避免干擾 CSV 格式

測試結果輸出
每筆資料輸出為一行文字 以 console.log 印出
開頭為 CSV_LINE 字樣 方便後續用 grep 擷取
輸出欄位依序為
email
nickname
pid
event_signup_id
event_signup_form_id
start_time
addRespTime
queryRespTime
error
無須寫入實體 CSV 檔案 後續使用 shell 工具 grep 或 sed 彙整即可

handleSummary 輸出
僅以 console.log 印出 k6 的 metrics 統計資訊
無需額外產生 HTML 或 JSON 報告
如需擴充可另行設定

三 產品面需求

add API
POST 請求至指定 URL
payload 包含 event_id pid nickname email event_signup_id
event_signup_id 為自產 UUID v4
固定 session_id 寫入 signup_session_ids 欄位
回應應包含 success 為 true
data 物件內 is_ok 為 true status 為 1

query API
GET 請求至指定 URL 包含活動 event_id 與使用者 pid
回應需包含 data.signup_info 且為非空陣列
其中 event_signup_form_id 為後續辨識用欄位
若有 session_list 欄位可根據需求擴充解析

API 回應驗證
每次 API 呼叫都要驗證
HTTP status 為 200
JSON 結構能成功 parse
回傳結果中 success data.is_ok data.status 符合預期

四 可調整變數

vus 測試時使用的併發數
duration 測試最大執行時間
iterationsPerVU 每個 VU 執行的次數
event_id 測試活動 ID
session_id 測試使用的場次 ID
CSV 檔案名稱與路徑
報表輸出格式與欄位配置

五 執行與整合建議

可用 shell script 包裝執行指令
執行 k6 後用 grep 抓取含 CSV_LINE 的行
使用 awk 或 sed 將 console output 彙整為結構化 CSV
後續如有需求再導出成 HTML 圖表或統計摘要

六 延伸使用說明

此範本可重複應用於其他需要逐筆資料控制壓測的系統
如問卷系統 登入驗證系統 權限 API 呼叫鏈測試等
只需根據 API 格式及驗證邏輯微調
可快速建立壓測與紀錄輸出流程